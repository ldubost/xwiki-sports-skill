<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc version="1.3" reference="Sports.Code.Query" locale="">
  <web>Sports.Code</web>
  <name>Query</name>
  <language/>
  <defaultLanguage>en</defaultLanguage>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1546297200000</creationDate>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1546297200000</date>
  <contentUpdateDate>1546297200000</contentUpdateDate>
  <version>1.1</version>
  <title>Sports Results Query</title>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>{{velocity}}
{{html clean="false"}}
&lt;script type="text/javascript"&gt;
require(['jquery'], function($) {

  function speak(text) {
    $("#results").html($("#results").html() + "&lt;br /&gt;" +  text);
    var synth = window.speechSynthesis;
    var utterThis = new SpeechSynthesisUtterance(text);
    utterThis.lang = 'en-US'
    synth.speak(utterThis);
  }

  function go(form) {
       var regex = /(.*?)-(.*?)-(.*?)-(.*)/;
       var found = form.sport.value.match(regex);

       var sport = found[1].replace("vb", "volley-ball");
       var competition = found[2];
       var year = found[3];
       var type = found[4];
       speak("Retrieving " + sport + " results for player " + form.player.value);
       var url = "/xwiki/bin/get/Sports/Code/JSON?outputSyntax=plain&amp;type=" + type + "&amp;year=" + year + "&amp;sport="+ sport + "&amp;competition=" + competition + "&amp;player=" + encodeURIComponent(form.player.value) + "&amp;nb=" + form.nb.value;
       if (form.save &amp;&amp; form.save.checked)
        url += "&amp;save=1";
       console.log("URL: " + url)
       $.getJSON(url, function(result) {
           console.log(result);
           if (!result || !result.text || result.text=="")
            speak("No results found")
           else
            speak(result.text);
       }).error(function() { speak("An error occured while retrieving results")});
  }
  window.go = go;
});
&lt;/script&gt;
&lt;form action="" onsubmit="window.go(this); return false;"&gt;
Player or Team: &lt;input type="text" name="player" value="" /&gt;
   &lt;select name="sport"&gt;
#set($sg = $xwiki.parseGroovyFromPage("Sports.Code.Groovy"))
#set($ok = $sg.setXWiki($xwiki, $xcontext, $services))
#set($sources = $sg.loadSources(false))
$sources
   #foreach($source in $sources)
     &lt;option value="${source.sport}-${source.competition}-${source.year}-${source.type}"&gt;${source.title}&lt;/option&gt;
   #end
   &lt;/select&gt;
   &lt;select name="nb"&gt;
     &lt;option value="1"&gt;1 result&lt;/option&gt;
     &lt;option value="2"&gt;2 results&lt;/option&gt;
     &lt;option value="3"&gt;3 results&lt;/option&gt;
     &lt;option value="4"&gt;4 results&lt;/option&gt;
     &lt;option value="5"&gt;5 results&lt;/option&gt;
   &lt;/select&gt;
  #if($hasAdmin)
  &lt;input type="checkbox" name="save" value="1" /&gt; Save pages
  #end
  &lt;input type="submit" value="Go" class="button"/&gt;
  &lt;br /&gt;
&lt;/form&gt;
&lt;div id="results"&gt;
&lt;/div&gt;
{{/html}}
{{/velocity}}</content>
</xwikidoc>
